<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üç≤ Recipe Explorer</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    h1 { text-align: center; margin-bottom: 20px; }
    input { padding: 5px; width: 250px; margin-bottom: 10px; border-radius: 4px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { cursor: pointer; background: #f2f2f2; }
    th.sort-asc::after { content: " ‚Üë"; }
    th.sort-desc::after { content: " ‚Üì"; }
    button { margin: 0 3px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
    button.active { background-color: #007bff; color: #fff; }
  </style>
</head>
<body>

  <h1>üç≤ Recipe Explorer</h1>
  <input type="text" id="searchInput" placeholder="Search recipes...">

  <table id="recipeTable">
    <thead>
      <tr>
        <th data-field="title">Title</th>
        <th data-field="cuisine">Cuisine</th>
        <th data-field="prep_time">Prep Time</th>
        <th data-field="cook_time">Cook Time</th>
        <th data-field="total_time">Total Time</th>
        <th data-field="rating">Rating</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="pagination"></div>

  <script>
    const apiUrl = "/api/recipes"; // fetch from backend
    let recipes = [];
    let currentPage = 1;
    const recipesPerPage = 5;
    let sortBy = "title";
    let sortOrder = "asc";

    const tableBody = document.querySelector("#recipeTable tbody");
    const searchInput = document.getElementById("searchInput");
    const paginationDiv = document.getElementById("pagination");
    const headers = document.querySelectorAll("th[data-field]");

    async function fetchRecipes() {
      try {
        const res = await fetch(apiUrl);
        recipes = await res.json();
        renderTable();
      } catch (err) {
        console.error("Error fetching recipes:", err);
      }
    }

    function renderTable() {
      const searchTerm = searchInput.value.toLowerCase();
      let filtered = recipes.filter(r => r.title.toLowerCase().includes(searchTerm));

      filtered.sort((a, b) => {
        let valA = a[sortBy] || "";
        let valB = b[sortBy] || "";
        if (typeof valA === "string") valA = valA.toLowerCase();
        if (typeof valB === "string") valB = valB.toLowerCase();
        if (valA < valB) return sortOrder === "asc" ? -1 : 1;
        if (valA > valB) return sortOrder === "asc" ? 1 : -1;
        return 0;
      });

      const totalPages = Math.ceil(filtered.length / recipesPerPage);
      const start = (currentPage - 1) * recipesPerPage;
      const end = start + recipesPerPage;
      const pageRecipes = filtered.slice(start, end);

      tableBody.innerHTML = "";
      pageRecipes.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${r.title}</td>
          <td>${r.cuisine || ""}</td>
          <td>${r.prep_time || ""}</td>
          <td>${r.cook_time || ""}</td>
          <td>${r.total_time || ""}</td>
          <td>${r.rating || ""}</td>
        `;
        tableBody.appendChild(row);
      });

      // Pagination
      paginationDiv.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.classList.add("active");
        btn.addEventListener("click", () => {
          currentPage = i;
          renderTable();
        });
        paginationDiv.appendChild(btn);
      }

      // Sort arrows
      headers.forEach(h => {
        h.classList.remove("sort-asc", "sort-desc");
        if (h.dataset.field === sortBy) {
          h.classList.add(sortOrder === "asc" ? "sort-asc" : "sort-desc");
        }
      });
    }

    searchInput.addEventListener("input", () => { currentPage = 1; renderTable(); });

    headers.forEach(h => {
      h.addEventListener("click", () => {
        const field = h.dataset.field;
        if (sortBy === field) sortOrder = sortOrder === "asc" ? "desc" : "asc";
        else { sortBy = field; sortOrder = "asc"; }
        renderTable();
      });
    });

    fetchRecipes();
  </script>

</body>
</html>
